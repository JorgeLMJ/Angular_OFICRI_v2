<div class="mb-4 p-3 bg-light border rounded">
  <h5 class="text-primary mb-3"><i class="bi bi-cloud-upload me-2"></i>ðŸ“¤ Subir Oficio</h5>
  <div class="d-flex align-items-center">
    <input type="file" class="form-control" accept=".pdf,.png,.jpg,.jpeg" (change)="onFileSelected($event)" #fileInput>
    <button type="button" class="btn btn-outline-primary ms-2" (click)="fileInput.click()">
      <i class="bi bi-magic me-1"></i> ExtracciÃ³n de datos
    </button>
  </div>
  <small class="text-muted">Sube un PDF, PNG o JPG del oficio. La IA extraerÃ¡ los datos automÃ¡ticamente.</small>
</div>

<!-- âœ… DIVISIÃ“N EN DOS COLUMNAS -->
<div class="container mt-4">
  <div class="row g-4">
    <!-- âœ… Columna IZQUIERDA: Formulario -->
    <div class="col-md-6">
      <div class="card shadow-lg h-100">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="bi bi-file-earmark-plus-fill me-2"></i>
            {{ documentoForm.get('id')?.value ? 'Editar Documento' : 'Registrar Documento' }}
          </h4>
        </div>
        <div class="card-body">
          <form [formGroup]="documentoForm" (ngSubmit)="onSubmit()" novalidate>
            <!-- ðŸ‘‡ Todo tu formulario original aquÃ­ -->
            <div class="mb-4 p-3 bg-light rounded">
              <h5 class="text-primary mb-4"><i class="bi bi-file-earmark me-2"></i>ðŸ“„ Oficio</h5>
              <div class="row mb-3">
                <div class="col-md-3" *ngIf="false">
                  <label class="form-label">Nombre Documento</label>
                  <input type="text" class="form-control" formControlName="nombreDocumento" placeholder="Ej: INFORME PERICIAL DE DOSAJE ETILICO" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">NÂ° Registro</label>
                  <input type="number" class="form-control" formControlName="nro_registro" placeholder="Ingrese el nÂ° de registro" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">NÂ° Oficio</label>
                  <input type="number" class="form-control" formControlName="nroOficio" placeholder="Ingrese nÃºmero" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Fecha de Oficio</label>
                  <input type="date" class="form-control" formControlName="fechaIngreso" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Nombre Oficio</label>
                  <textarea class="form-control" formControlName="nombreOficio" placeholder="Ej: INFORME PERICIAL" rows="3" required></textarea>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Asunto</label>
                  <textarea class="form-control" formControlName="asunto" placeholder="Asunto del documento" rows="3" required></textarea>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-3"><label class="form-label">Nombres</label><input type="text" class="form-control" formControlName="nombres" required></div>
                <div class="col-md-3"><label class="form-label">Apellidos</label><input type="text" class="form-control" formControlName="apellidos" required></div>
                <div class="col-md-3"><label class="form-label">Edad</label><input type="number" class="form-control" formControlName="edad" required></div>
                <div class="col-md-3"><label class="form-label">DNI o CE</label><input type="text" class="form-control" formControlName="dni" required></div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6"><label class="form-label">SituaciÃ³n</label><input type="text" class="form-control" formControlName="situacion" required></div>
                <div class="col-md-6"><label class="form-label">Delito/InfracciÃ³n</label><input type="text" class="form-control" formControlName="delitoInfraccion" required></div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6"><label class="form-label">Fecha y hora del Incidente</label><input type="datetime-local" class="form-control" formControlName="fechaHoraIncidente" required></div>
                <div class="col-md-6"><label class="form-label">Procedencia</label><input type="text" class="form-control" formControlName="procedencia" required></div>
              </div>
            </div>

            <div class="mb-4 p-3 bg-light rounded">
              <h5 class="text-primary mb-4"><i class="bi bi-droplet me-2"></i>ðŸ§ª Acta de Toma de Muestra</h5>
              <div class="row mb-3">
                <div class="col-md-4"><label class="form-label">Fecha Acta</label><input type="date" class="form-control" formControlName="fechaActa"></div>
                <div class="col-md-4"><label class="form-label">Hora Toma de Muestra</label><input type="time" class="form-control" formControlName="horaTomaMuestra"></div>
                <div class="col-md-4">
                  <label class="form-label">Tipo de Muestra</label>
                  <div class="btn-group w-100">
                    <button type="button" class="btn btn-sm btn-outline-primary" [class.active]="documentoForm.get('tipoMuestra')?.value === 'Orina'" (click)="documentoForm.patchValue({ tipoMuestra: 'Orina' })">Orina</button>
                    <button type="button" class="btn btn-sm btn-outline-primary" [class.active]="documentoForm.get('tipoMuestra')?.value === 'Sangre'" (click)="documentoForm.patchValue({ tipoMuestra: 'Sangre' })">Sangre</button>
                    <button type="button" class="btn btn-sm btn-outline-primary" [class.active]="documentoForm.get('tipoMuestra')?.value === 'Humor Vitreo'" (click)="documentoForm.patchValue({ tipoMuestra: 'Humor Vitreo' })">Humor VÃ­treo</button>
                  </div>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6"><label class="form-label">Persona que Conduce</label><input type="text" class="form-control" formControlName="personaQueConduce"></div>
                <div class="col-md-6">
                  <label class="form-label">Cualitativo</label>
                  <div class="btn-group w-100">
                    <button type="button" class="btn btn-sm btn-outline-success" [class.active]="documentoForm.get('cualitativo')?.value === 'POSITIVO'" (click)="documentoForm.patchValue({ cualitativo: 'POSITIVO' })">POSITIVO</button>
                    <button type="button" class="btn btn-sm btn-outline-danger" [class.active]="documentoForm.get('cualitativo')?.value === 'NEGATIVO'" (click)="documentoForm.patchValue({ cualitativo: 'NEGATIVO' })">NEGATIVO</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" [class.active]="documentoForm.get('cualitativo')?.value === 'INDETERMINADO'" (click)="documentoForm.patchValue({ cualitativo: 'INDETERMINADO' })">INDETERMINADO</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-4 p-3 bg-light rounded">
              <h5 class="text-primary mb-4"><i class="bi bi-paperclip me-2"></i>ðŸ“Ž Anexos</h5>
              <div formGroupName="anexos" class="row">
                <div class="col-md-6">
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="cadenaCustodia" formControlName="cadenaCustodia"><label class="form-check-label" for="cadenaCustodia">Formato de cadena de custodia.</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="rotulo" formControlName="rotulo"><label class="form-check-label" for="rotulo">Rotulo</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="actaTomaMuestra" formControlName="actaTomaMuestra"><label class="form-check-label" for="actaTomaMuestra">Acta de toma de muestra</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="actaConsentimiento" formControlName="actaConsentimiento"><label class="form-check-label" for="actaConsentimiento">Acta de consentimiento</label></div>
                </div>
                <div class="col-md-6">
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="actaDenunciaVerbal" formControlName="actaDenunciaVerbal"><label class="form-check-label" for="actaDenunciaVerbal">Acta de denuncia verbal</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="actaIntervencionPolicial" formControlName="actaIntervencionPolicial"><label class="form-check-label" for="actaIntervencionPolicial">Acta de intervenciÃ³n policial</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="copiaDniSidpol" formControlName="copiaDniSidpol"><label class="form-check-label" for="copiaDniSidpol">Copia de DNI, SIDPOL</label></div>
                  <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="actaObtencionMuestra" formControlName="actaObtencionMuestra"><label class="form-check-label" for="actaObtencionMuestra">Acta de obtencion de muestra de sangre</label></div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end">
              <button type="button" class="btn btn-secondary me-2" (click)="cancelar()">
                <i class="bi bi-x-circle me-1"></i> Cancelar
              </button>
              <button type="submit" class="btn btn-primary" [disabled]="documentoForm.invalid">
                <i class="bi bi-save me-1"></i>
                {{ documentoForm.get('id')?.value ? 'Actualizar' : 'Guardar' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- âœ… Columna DERECHA: Vista previa en formato Word/PDF -->
    <div class="col-md-6">
      <div class="card shadow h-100" style="border-left: 2px solid #dee2e6;">
        <div class="card-header bg-light text-dark">
          <h5 class="mb-0"><i class="bi bi-eye me-2"></i>Vista Previa del Documento</h5>
        </div>
        <div class="card-body p-3" style="background-color: #fff; font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4;">
          <!-- ðŸ‘‡ AquÃ­ va la vista previa en tiempo real -->
          <div style="max-width: 800px; margin: 0 auto;">
            <!-- Encabezado -->
            <div style="text-align: center; margin-bottom: 10px;">
              <img src="/assets/img/logo_pnp.png" alt="Logo PNP" style="width: 150px; height: auto; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto;">
              <h1 style="margin: 2px 0; font-size: 12px; font-weight: normal;">POLICIA NACIONAL DEL PERU</h1>
              <h1 style="margin: 2px 0; font-size: 12px; font-weight: normal;">Oficina de CriminalÃ­stica</h1>
            </div>

            <!-- TÃ­tulo -->
            <div style="text-align: center; margin-bottom: 15px;">
              <span style="font-weight: bold; font-size: 16px; text-decoration: underline; display: inline-block;">
                {{ documentoForm.get('nombreDocumento')?.value || (currentUserRole === 'Auxiliar de Toxicologia' ? 'INFORME PERICIAL DE TOXICOLOGIA' : 'INFORME PERICIAL DE DOSAJE') }}
              </span>
            </div>

            <!-- NÃºmero de informe -->
            <div style="text-align: right; font-weight: bold; margin-bottom: 15px;">
              NÂº {{ documentoForm.get('nro_registro')?.value || 'S/N' }}/2026
            </div>

            <!-- Secciones A-H -->
            <div style="font-size: 13px;">
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">A. PROCEDENCIA</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ documentoForm.get('procedencia')?.value || '' }}</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">B. ANTECEDENTE</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: OFICIO. NÂº {{ documentoForm.get('nroOficio')?.value || 'S/N' }} - 2026 - {{ documentoForm.get('nombreOficio')?.value || '' }} DEL {{ formatDatePreview(documentoForm.get('fechaHoraIncidente')?.value) }}</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">C. DATOS DEL PERITO</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: CAP. (S) PNP Javier Alexander HUAMANI CORDOVA, identificada con CIP NÂº.419397 QuÃ­mico FarmacÃ©utico CQFP 20289, con domicilio procesal en la calle Alcides Vigo NÂ°133 Wanchaq - Cusco</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">D. HORA DEL INCIDENTE</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ parseTime(documentoForm.get('fechaHoraIncidente')?.value) }} &nbsp;&nbsp; <b>FECHA:</b> {{ formatDatePreview(documentoForm.get('fechaHoraIncidente')?.value) }}</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">E. HORA DE TOMA DE MUESTRA</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ documentoForm.get('horaTomaMuestra')?.value || '' }} &nbsp;&nbsp; <b>FECHA:</b> {{ formatDatePreview(documentoForm.get('fechaActa')?.value) }} (Usuario Actual)</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">F. TIPO DE MUESTRA</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ documentoForm.get('tipoMuestra')?.value || '' }}</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">G. PERSONA QUE CONDUCE</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ documentoForm.get('personaQueConduce')?.value || '' }}</span>
              </div>
              <div style="margin-bottom: 15px; display: grid; grid-template-columns: 200px 1fr; align-items: baseline;">
                <span style="font-weight: bold;">H. EXAMINADO</span>
                <span style="border-bottom: 1px dotted #000; padding: 5px 5px 5px 10px; text-align: left;">: {{ documentoForm.get('nombres')?.value || '' }} {{ documentoForm.get('apellidos')?.value || '' }} ({{ documentoForm.get('edad')?.value || '' }}), DNI NÂº:{{ documentoForm.get('dni')?.value || '' }}</span>
              </div>
            </div>

            <!-- Pie de pÃ¡gina simulado -->
            <div style="position: relative; margin-top: 40px; text-align: center; font-size: 7pt; color: #000; padding-top: 10px; border-top: 1px solid #ccc;">
              Calle Alcides Vigo Hurtado NÂ°-133, distrito de WÃ¡nchaq â€“ Cusco. Cel. NÂ°980 121873.<br>
              Email: oficricuscomail.com
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>